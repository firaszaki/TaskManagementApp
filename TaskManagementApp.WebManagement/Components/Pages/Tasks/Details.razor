@page "/tasks/{Id:long}/details"

<MudContainer MaxWidth="MaxWidth.Small" Class="pt-5">
    <MudGrid>

        @if(Data is null)
        {
            <MudItem xs="12">
                <TaskManagementApp.WebManagement.Components.Shared.LoadingComponent />
            </MudItem>
            
        }
        else
        {
            <MudItem xs="12">
                <MudPaper Class="pa-5 rounded-border" Outlined>
                    <MudText Typo="Typo.body1" Class="mb-n2">Title</MudText>
                    <MudText Typo="Typo.h6" Class="fw-bold mb-2">@Data.Title</MudText>

                    <MudText Typo="Typo.body1" Class="mb-n2">Description</MudText>
                    <MudText Typo="Typo.body1" Class="mb-2 fw-bold">@Data.Description</MudText>

                    <MudText Typo="Typo.body1" Class="mb-n2">Status</MudText>
                    <MudText Typo="Typo.body1" Align="Align.Start" Class="mb-2">
                        @switch (Data.Status)
                        {
                            case Domain.Entities.TaskStatus.InProgress:
                                <MudChip T="string" Size="Size.Medium" Icon="@Icons.Material.Filled.HourglassBottom" Color="Color.Default">
                                    <MudText Typo="Typo.body1">In Progress</MudText>
                                </MudChip>
                                break;

                            case Domain.Entities.TaskStatus.Pending:
                                <MudChip T="string" Size="Size.Medium" Icon="@Icons.Material.Filled.PendingActions" Color="Color.Warning">
                                    <MudText Typo="Typo.body1">Pending</MudText>
                                </MudChip>
                                break;

                            case Domain.Entities.TaskStatus.Completed:
                                <MudChip T="string" Size="Size.Medium" Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success">
                                    <MudText Typo="Typo.body1">Completed</MudText>
                                </MudChip>
                                break;
                        }
                    </MudText>

                    <MudText Typo="Typo.body1" Class="mb-n1">Created Date</MudText>
                    <MudText Typo="Typo.body1" Class="mb-2 fw-bold" Style="white-space: pre-line; line-height:1.1;">@(Data.CreatedAt.HasValue ? Data.CreatedAt.Value.ToString("h:mm tt \n d MMMM yyyy") : "")</MudText>
                </MudPaper>
            </MudItem>
        }
        
    </MudGrid>
</MudContainer>

@code {
    [Parameter] public long Id { get; set; }

    [Inject] private TaskRepository TaskRepository { get; set; } = default!;

    private TaskEntity? Data { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();

        await LoadDataAsync(Id);
    }

    private async Task LoadDataAsync(long id)
    {
        var result = await TaskRepository.GetAsync(id); 
        if(!result.IsSuccess)
        {
            Data = null;
            Snackbar.Add("Data not found", Severity.Error);
            NavigationManager.NavigateTo("/tasks");
            return;
        }

        Data = result.Data;
    }
}
